<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•™å¸ˆä»ªè¡¨ç›˜ - AIæ™ºæ…§è¯¾å ‚</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* åŸºç¡€æ ·å¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            font-size: 24px;
            margin-bottom: 10px;
        }
        
        .classroom-info {
            display: flex;
            gap: 20px;
            font-size: 14px;
        }
        
        /* æ§åˆ¶é¢æ¿æ ·å¼ */
        .simulation-control-panel {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .control-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .control-buttons {
            display: flex;
            gap: 10px;
        }
        
        .control-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .control-btn.primary {
            background: #667eea;
            color: white;
        }
        
        .control-btn.secondary {
            background: #48bb78;
            color: white;
        }
        
        .control-btn.warning {
            background: #ed8936;
            color: white;
        }
        
        .control-btn.danger {
            background: #f56565;
            color: white;
        }
        
        .control-btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }
        
        .simulation-status {
            display: flex;
            gap: 20px;
            font-size: 14px;
            color: #718096;
        }
        
        /* é€šçŸ¥é¢æ¿æ ·å¼ */
        .notification-panel {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .notification-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .notification-list {
            max-height: 200px;
            overflow-y: auto;
        }
        
        .notification-item {
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 5px;
            border-left: 4px solid #a0aec0;
        }
        
        .notification-item.info {
            border-left-color: #4299e1;
            background: #ebf8ff;
        }
        
        .notification-item.error {
            border-left-color: #f56565;
            background: #fed7d7;
        }
        
        .notification-item.action {
            border-left-color: #48bb78;
            background: #f0fff4;
        }
        
        .notification-item.response {
            border-left-color: #ed8936;
            background: #fffaf0;
        }
        
        .notification-item.question {
            border-left-color: #9f7aea;
            background: #faf5ff;
        }
        
        .notification-time {
            font-size: 12px;
            color: #718096;
            margin-right: 10px;
        }
        
        /* åˆ†æç½‘æ ¼æ ·å¼ */
        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .analytics-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .analytics-card h4 {
            margin-bottom: 15px;
            color: #2d3748;
        }
        
        .emotion-chart {
            display: flex;
            align-items: flex-end;
            height: 150px;
            gap: 10px;
            padding: 10px 0;
        }
        
        .emotion-bar {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-end;
            border-radius: 5px 5px 0 0;
            transition: height 0.5s;
        }
        
        .emotion-bar.positive {
            background: #48bb78;
        }
        
        .emotion-bar.neutral {
            background: #ed8936;
        }
        
        .emotion-bar.negative {
            background: #f56565;
        }
        
        .emotion-label {
            color: white;
            text-align: center;
            font-size: 12px;
            margin-top: 5px;
            font-weight: bold;
        }
        
        .detailed-metrics {
            margin-top: 10px;
        }
        
        .metric-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding: 5px 0;
            border-bottom: 1px solid #e2e8f0;
        }
        
        /* ä»ªè¡¨ç›˜æ ·å¼ */
        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .dashboard-section {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .live-indicator {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 14px;
            color: #48bb78;
        }
        
        .indicator-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #48bb78;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        /* å­¦ç”Ÿç½‘æ ¼æ ·å¼ */
        .students-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
        }
        
        .student-card {
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            transition: all 0.3s;
        }
        
        .student-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .student-name {
            font-weight: bold;
            margin-bottom: 10px;
            color: #2d3748;
        }
        
        .student-metrics {
            margin-bottom: 10px;
        }
        
        .metric {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .progress-bar {
            flex: 1;
            height: 6px;
            background: #e2e8f0;
            border-radius: 3px;
            margin: 0 10px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: #667eea;
            border-radius: 3px;
            transition: width 0.5s;
        }
        
        .student-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
        }
        
        .student-emotion {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
        }
        
        .emotion-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }
        
        .emotion-positive {
            background: #48bb78;
        }
        
        .emotion-negative {
            background: #f56565;
        }
        
        .emotion-neutral {
            background: #ed8936;
        }
        
        .learning-state {
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .state-excellent {
            background: #c6f6d5;
            color: #22543d;
        }
        
        .state-moderate {
            background: #fed7d7;
            color: #742a2a;
        }
        
        .state-needs_help {
            background: #feebcb;
            color: #744210;
        }
        
        .detailed-metrics {
            margin-top: 10px;
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #718096;
        }
        
        /* æŒ‡æ ‡æ¦‚è§ˆæ ·å¼ */
        .metrics-overview {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .metric-card {
            background: #f7fafc;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }
        
        .metric-value {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }
        
        .metric-label {
            font-size: 14px;
            color: #718096;
        }
        
        /* å›¾è¡¨å®¹å™¨ */
        .chart-container {
            height: 200px;
            margin-bottom: 20px;
        }
        
        /* è§†è§‰æŒ‡æ ‡æ ·å¼ */
        .vision-metrics {
            margin-top: 15px;
        }
        
        .vision-metric {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .vision-metric .metric-label {
            width: 120px;
            font-size: 14px;
        }
        
        .vision-metric .progress-bar {
            flex: 1;
            margin: 0 10px;
        }
        
        .vision-metric .metric-value {
            width: 40px;
            font-size: 14px;
            text-align: right;
        }
        
        /* äº’åŠ¨å·¥å…·æ ·å¼ */
        .interaction-tools {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .tool-card {
            background: #f7fafc;
            border-radius: 8px;
            padding: 15px;
        }
        
        .tool-card h4 {
            margin-bottom: 10px;
        }
        
        .tool-card input {
            width: 100%;
            padding: 8px;
            border: 1px solid #e2e8f0;
            border-radius: 5px;
            margin-bottom: 10px;
        }
        
        .tool-card button {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
        }
        
        /* AIæ¨¡æ‹Ÿé¢æ¿æ ·å¼ */
        .ai-simulation-panel {
            background: #f7fafc;
            border-radius: 8px;
            padding: 15px;
        }
        
        .ai-controls {
            margin-top: 10px;
        }
        
        .ai-actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        
        .ai-btn {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 5px;
            padding: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .ai-btn:hover {
            background: #667eea;
            color: white;
        }
        
        /* ç©ºçŠ¶æ€æ ·å¼ */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #718096;
        }
        
        .empty-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }
        
        /* æ–°å¢æ ·å¼ */
        .student-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .student-selector select {
            flex: 1;
            padding: 8px;
            border: 1px solid #e2e8f0;
            border-radius: 5px;
        }
        
        .analysis-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .analysis-result {
            background: #f7fafc;
            padding: 15px;
            border-radius: 8px;
            min-height: 100px;
        }
        
        .pattern-recognition {
            margin-top: 10px;
        }
        
        .pattern-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding: 5px 0;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .anomaly-list {
            max-height: 200px;
            overflow-y: auto;
        }
        
        .anomaly-item {
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 6px;
            border-left: 4px solid #ecc94b;
        }
        
        .anomaly-item.high {
            border-left-color: #f56565;
            background: #fed7d7;
        }
        
        .anomaly-item.medium {
            border-left-color: #ed8936;
            background: #feebc8;
        }
        
        .anomaly-item.low {
            border-left-color: #ecc94b;
            background: #fefcbf;
        }
        
        .anomaly-item.none {
            border-left-color: #a0aec0;
            background: #e2e8f0;
            text-align: center;
            color: #718096;
        }
        
        .time-range-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .time-btn {
            padding: 6px 12px;
            border: 1px solid #e2e8f0;
            background: white;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .time-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        
        .recommendations-panel {
            background: #f7fafc;
            border-radius: 10px;
            padding: 15px;
        }
        
        .recommendation-item {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            padding: 12px;
            margin-bottom: 10px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        
        .rec-icon {
            font-size: 24px;
        }
        
        .rec-content {
            flex: 1;
        }
        
        .rec-title {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 5px;
        }
        
        .rec-description {
            color: #718096;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>æ•™å¸ˆä»ªè¡¨ç›˜ - AIæƒ…æ„Ÿä¸æ³¨æ„åŠ›åˆ†æ</h1>
            <div class="classroom-info">
                <span id="classroomName">è¯¾å ‚ID: <span id="classroomIdDisplay"></span></span>
                <span id="studentCount">å­¦ç”Ÿæ•°: 0</span>
                <span id="avgAttention">å¹³å‡æ³¨æ„åŠ›: --%</span>
            </div>
        </header>

        <!-- æ¨¡æ‹Ÿå­¦ç”Ÿæ§åˆ¶é¢æ¿ -->
        <div class="simulation-control-panel">
            <div class="control-header">
                <h3>ğŸ® AIæ¨¡æ‹Ÿæ§åˆ¶ç³»ç»Ÿ</h3>
                <div class="control-buttons">
                    <button class="control-btn primary" onclick="generateSimulatedStudents()">
                        ğŸ‘¥ ç”Ÿæˆæ¨¡æ‹Ÿå­¦ç”Ÿ
                    </button>
                    <button class="control-btn secondary" onclick="startAISimulation()">
                        ğŸ¬ å¯åŠ¨AIæ¨¡æ‹Ÿ
                    </button>
                    <button class="control-btn warning" onclick="stopAISimulation()">
                        â¹ï¸ åœæ­¢æ¨¡æ‹Ÿ
                    </button>
                    <button class="control-btn danger" onclick="clearAllStudents()">
                        ğŸ—‘ï¸ æ¸…ç©ºå­¦ç”Ÿ
                    </button>
                </div>
            </div>
            <div class="simulation-status">
                <span id="simulationStatus">ğŸ”´ æ¨¡æ‹Ÿæœªå¯åŠ¨</span>
                <span id="aiDetectionStatus">ğŸ–¥ï¸ è®¡ç®—æœºè§†è§‰: æœªè¿æ¥</span>
            </div>
        </div>

        <!-- å®æ—¶é€šçŸ¥é¢æ¿ -->
        <div class="notification-panel" id="notificationPanel">
            <div class="notification-header">
                <h4>ğŸ”” å®æ—¶è¯¾å ‚åŠ¨æ€</h4>
                <button onclick="clearNotifications()">æ¸…ç©º</button>
            </div>
            <div class="notification-list" id="notificationList">
                <div class="notification-item info">
                    <span class="notification-time" id="currentTime"></span>
                    <span class="notification-message">ç­‰å¾…è¯¾å ‚æ´»åŠ¨å¼€å§‹...</span>
                </div>
            </div>
        </div>

        <!-- æ•°æ®åˆ†ææ¦‚è§ˆ -->
        <div class="analytics-grid">
            <div class="analytics-card">
                <h4>æƒ…æ„ŸçŠ¶æ€åˆ†å¸ƒ</h4>
                <div class="emotion-chart" id="emotionChart">
                    <div class="chart-placeholder">
                        <p>ç­‰å¾…å­¦ç”Ÿæ•°æ®...</p>
                    </div>
                </div>
            </div>
            
            <div class="analytics-card">
                <h4>æ³¨æ„åŠ›åˆ†æ</h4>
                <div class="detailed-metrics">
                    <div class="metric-item">
                        <span class="metric-label">é«˜æ³¨æ„åŠ›:</span>
                        <span class="metric-value" id="highAttentionCount">0</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">ä½æ³¨æ„åŠ›:</span>
                        <span class="metric-value" id="lowAttentionCount">0</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">ç¨³å®šæ€§:</span>
                        <span class="metric-value" id="attentionStability">--</span>
                    </div>
                </div>
            </div>
            
            <div class="analytics-card">
                <h4>å®æ—¶è¶‹åŠ¿</h4>
                <div class="timeline" id="attentionTrend">
                    <div class="timeline-placeholder">
                        <p>æš‚æ— æ•°æ®</p>
                    </div>
                </div>
            </div>
            
            <!-- é«˜çº§åˆ†æé¢æ¿ -->
            <!-- å­¦ç”Ÿä¸ªä½“åˆ†æ -->
            <div class="analytics-card">
                <h4>ğŸ¯ å­¦ç”Ÿä¸ªä½“åˆ†æ</h4>
                <div class="student-selector">
                    <select id="studentSelector" onchange="loadStudentAnalysis()">
                        <option value="">é€‰æ‹©å­¦ç”Ÿ...</option>
                    </select>
                    <button onclick="loadStudentAnalysis()" class="analysis-btn">åˆ†æ</button>
                </div>
                <div id="studentAnalysisResult" class="analysis-result">
                    <p>é€‰æ‹©å­¦ç”ŸæŸ¥çœ‹è¯¦ç»†åˆ†æ</p>
                </div>
            </div>
            
            <!-- å­¦ä¹ æ¨¡å¼è¯†åˆ« -->
            <div class="analytics-card">
                <h4>ğŸ“Š å­¦ä¹ æ¨¡å¼è¯†åˆ«</h4>
                <div class="pattern-recognition">
                    <div class="pattern-item">
                        <span class="pattern-label">é«˜æ•ˆå­¦ä¹ è€…:</span>
                        <span class="pattern-value" id="efficientLearners">0</span>
                    </div>
                    <div class="pattern-item">
                        <span class="pattern-label">éœ€è¦å…³æ³¨:</span>
                        <span class="pattern-value" id="needsAttention">0</span>
                    </div>
                    <div class="pattern-item">
                        <span class="pattern-label">æ³¢åŠ¨å‹:</span>
                        <span class="pattern-value" id="volatileLearners">0</span>
                    </div>
                </div>
            </div>
            
            <!-- å¼‚å¸¸æ£€æµ‹ -->
            <div class="analytics-card">
                <h4>âš ï¸ å¼‚å¸¸æ£€æµ‹</h4>
                <div id="anomalyDetection">
                    <div class="anomaly-list" id="anomalyList">
                        <div class="anomaly-item none">
                            <span>æš‚æ— å¼‚å¸¸æ£€æµ‹</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="dashboard">
            <!-- å­¦ç”ŸçŠ¶æ€ç›‘æ§ -->
            <div class="dashboard-section">
                <div class="section-header">
                    <h3>ğŸ‘¥ å­¦ç”ŸçŠ¶æ€ç›‘æ§</h3>
                    <div class="live-indicator">
                        <span class="indicator-dot"></span>
                        <span>å®æ—¶æ›´æ–°</span>
                    </div>
                </div>
                <div class="students-grid" id="studentsGrid">
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ“</div>
                        <h4>æš‚æ— å­¦ç”Ÿæ•°æ®</h4>
                        <p>ç‚¹å‡»"ç”Ÿæˆæ¨¡æ‹Ÿå­¦ç”Ÿ"å¼€å§‹è¯¾å ‚ç›‘æ§</p>
                    </div>
                </div>
            </div>

            <!-- è¯¾å ‚æ•°æ®æ¦‚è§ˆ -->
            <div class="dashboard-section">
                <h3>ğŸ“Š è¯¾å ‚æ•°æ®åˆ†æ</h3>
                <div class="metrics-overview">
                    <div class="metric-card">
                        <div class="metric-value" id="avgAttentionMetric">0%</div>
                        <div class="metric-label">å¹³å‡æ³¨æ„åŠ›</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="avgEngagement">0%</div>
                        <div class="metric-label">å¹³å‡å‚ä¸åº¦</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="activeStudents">0</div>
                        <div class="metric-label">æ´»è·ƒå­¦ç”Ÿ</div>
                    </div>
                </div>

                <div class="chart-container">
                    <canvas id="engagementChart"></canvas>
                </div>

                <!-- è®¡ç®—æœºè§†è§‰æŒ‡æ ‡ -->
                <div class="detailed-metrics" style="margin-top: 20px;">
                    <h4>ğŸ–¥ï¸ è®¡ç®—æœºè§†è§‰ç›‘æµ‹æŒ‡æ ‡</h4>
                    <div class="vision-metrics">
                        <div class="vision-metric">
                            <span class="metric-label">ğŸ‘€ è§†çº¿ä¸“æ³¨åº¦</span>
                            <div class="progress-bar">
                                <div class="progress-fill" id="gazeFocusBar" style="width: 0%"></div>
                            </div>
                            <span class="metric-value" id="gazeFocusValue">--%</span>
                        </div>
                        <div class="vision-metric">
                            <span class="metric-label">ğŸ’º å§¿åŠ¿å‚ä¸åº¦</span>
                            <div class="progress-bar">
                                <div class="progress-fill" id="postureBar" style="width: 0%"></div>
                            </div>
                            <span class="metric-value" id="postureValue">--%</span>
                        </div>
                        <div class="vision-metric">
                            <span class="metric-label">ğŸ™‹ äº’åŠ¨é¢‘ç‡</span>
                            <div class="progress-bar">
                                <div class="progress-fill" id="interactionBar" style="width: 0%"></div>
                            </div>
                            <span class="metric-value" id="interactionValue">--%</span>
                        </div>
                    </div>
                </div>
                
                <!-- å†å²è¶‹åŠ¿åˆ†æ -->
                <div style="margin-top: 30px;">
                    <h3>ğŸ“ˆ å†å²è¶‹åŠ¿åˆ†æ</h3>
                    <div class="trend-analysis">
                        <div class="time-range-selector">
                            <button class="time-btn active" onclick="changeTimeRange(1)">1å°æ—¶</button>
                            <button class="time-btn" onclick="changeTimeRange(6)">6å°æ—¶</button>
                            <button class="time-btn" onclick="changeTimeRange(24)">24å°æ—¶</button>
                        </div>
                        <div class="chart-container">
                            <canvas id="historicalTrendChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- äº’åŠ¨å·¥å…· -->
            <div class="dashboard-section">
                <h3>ğŸ’¬ è¯¾å ‚äº’åŠ¨</h3>
                <div class="interaction-tools">
                    <div class="tool-card">
                        <h4>å¿«é€Ÿé—®ç­”</h4>
                        <input type="text" id="questionInput" placeholder="è¾“å…¥é—®é¢˜...">
                        <button onclick="startQuickQuestion()">å‘å¸ƒé—®é¢˜</button>
                    </div>

                    <div class="tool-card">
                        <h4>å®æ—¶åé¦ˆ</h4>
                        <div id="quickResponses">
                            <p>ç­‰å¾…å­¦ç”Ÿå›ç­”...</p>
                        </div>
                    </div>
                </div>

                <!-- AIè¡Œä¸ºæ¨¡æ‹Ÿ -->
                <div class="ai-simulation-panel">
                    <h4>ğŸ¤– AIè¡Œä¸ºæ¨¡æ‹Ÿå™¨</h4>
                    <div class="ai-controls">
                        <div class="ai-actions">
                            <button class="ai-btn" onclick="triggerAIDetection('face_focus')">
                                ğŸ‘ï¸ æ¨¡æ‹Ÿé¢éƒ¨ä¸“æ³¨
                            </button>
                            <button class="ai-btn" onclick="triggerAIDetection('hand_raise')">
                                ğŸ™‹ æ¨¡æ‹Ÿä¸¾æ‰‹
                            </button>
                            <button class="ai-btn" onclick="triggerAIDetection('posture_good')">
                                ğŸ’º æ¨¡æ‹Ÿç«¯æ­£åå§¿
                            </button>
                            <button class="ai-btn" onclick="triggerAIDetection('distraction')">
                                ğŸ˜´ æ¨¡æ‹Ÿåˆ†å¿ƒ
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- ä¸ªæ€§åŒ–å»ºè®® -->
                <div style="margin-top: 30px;">
                    <h3>ğŸ’¡ æ•™å­¦å»ºè®®</h3>
                    <div class="recommendations-panel">
                        <div id="teachingRecommendations">
                            <div class="recommendation-item">
                                <div class="rec-icon">ğŸ’¡</div>
                                <div class="rec-content">
                                    <div class="rec-title">ç­‰å¾…æ•°æ®åˆ†æ...</div>
                                    <div class="rec-description">ç³»ç»Ÿå°†æ ¹æ®å­¦ç”Ÿå­¦ä¹ çŠ¶æ€æä¾›ä¸ªæ€§åŒ–æ•™å­¦å»ºè®®</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const classroomId = urlParams.get('classroom') || `class_${Date.now()}`;
        const teacherName = urlParams.get('teacher') || 'å¼ è€å¸ˆ';

        document.getElementById('classroomIdDisplay').textContent = classroomId;
        
        let engagementChart;
        let historicalTrendChart;
        let simulationInterval;
        let aiSimulationInterval;
        let simulatedStudents = [];
        let notificationCount = 0;
        let currentTimeRange = 1;

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            updateCurrentTime();
            setInterval(updateCurrentTime, 1000);
            initCharts();
            
            // æ–°å¢é«˜çº§åˆ†æåˆå§‹åŒ–
            setTimeout(() => {
                initStudentSelector();
                updateAdvancedAnalytics();
                
                // å®šæœŸæ›´æ–°é«˜çº§åˆ†æ
                setInterval(updateAdvancedAnalytics, 30000); // æ¯30ç§’æ›´æ–°ä¸€æ¬¡
            }, 2000);
        });

        function updateCurrentTime() {
            const now = new Date();
            document.getElementById('currentTime').textContent = now.toLocaleTimeString('zh-CN');
        }

        // è¿æ¥Socket.io
        const socket = io('http://localhost:5000');

        // æ•™å¸ˆåŠ å…¥è¯¾å ‚
        socket.emit('teacher_join', {
            classroom_id: classroomId,
            teacher_id: `T${Date.now()}`
        });

        // ç”Ÿæˆæ¨¡æ‹Ÿå­¦ç”Ÿ
        function generateSimulatedStudents() {
            const studentNames = ['å¼ ä¸‰', 'æå››', 'ç‹äº”', 'èµµå…­', 'é’±ä¸ƒ', 'å­™å…«'];
            const studentTemplates = [
                { attention: 85, engagement: 90, emotion: 'focused' },
                { attention: 75, engagement: 80, emotion: 'neutral' },
                { attention: 65, engagement: 70, emotion: 'confused' },
                { attention: 90, engagement: 85, emotion: 'happy' },
                { attention: 55, engagement: 60, emotion: 'bored' },
                { attention: 80, engagement: 75, emotion: 'engaged' }
            ];

            simulatedStudents = studentNames.map((name, index) => {
                const template = studentTemplates[index % studentTemplates.length];
                return {
                    id: `sim-student-${Date.now()}-${index}`,
                    name: name,
                    attention_level: template.attention,
                    engagement_level: template.engagement,
                    emotion: template.emotion,
                    detailed_metrics: {
                        gaze_focus: Math.round(template.attention * 0.9 + Math.random() * 10),
                        posture_engagement: Math.round(template.engagement * 0.8 + Math.random() * 15),
                        interaction_frequency: Math.round(50 + Math.random() * 40)
                    },
                    socket_id: `sim-${index}`,
                    joined_at: new Date().toISOString(),
                    last_updated: new Date().toISOString()
                };
            });

            updateStudentGrid(simulatedStudents);
            updateMetrics(simulatedStudents);
            updateAnalytics();
            initStudentSelector();
            updateAdvancedAnalytics();

            addNotification(`ğŸ‘¥ å·²ç”Ÿæˆ ${simulatedStudents.length} ä¸ªæ¨¡æ‹Ÿå­¦ç”Ÿ`, 'join');
            document.getElementById('aiDetectionStatus').textContent = 'ğŸ–¥ï¸ è®¡ç®—æœºè§†è§‰: æ¨¡æ‹Ÿè¿æ¥';
        }

        // å¯åŠ¨AIæ¨¡æ‹Ÿ
        function startAISimulation() {
            if (simulatedStudents.length === 0) {
                addNotification('âŒ è¯·å…ˆç”Ÿæˆæ¨¡æ‹Ÿå­¦ç”Ÿ', 'error');
                return;
            }

            if (aiSimulationInterval) {
                clearInterval(aiSimulationInterval);
            }

            addNotification('ğŸ¬ AIæ¨¡æ‹Ÿå·²å¯åŠ¨ - è®¡ç®—æœºè§†è§‰æ•°æ®æµå¼€å§‹', 'info');
            document.getElementById('simulationStatus').innerHTML = 'ğŸŸ¢ æ¨¡æ‹Ÿè¿è¡Œä¸­';
            
            aiSimulationInterval = setInterval(() => {
                simulateAIDetection();
            }, 2000);
        }

        function stopAISimulation() {
            if (aiSimulationInterval) {
                clearInterval(aiSimulationInterval);
                aiSimulationInterval = null;
            }
            addNotification('â¹ï¸ AIæ¨¡æ‹Ÿå·²åœæ­¢', 'info');
            document.getElementById('simulationStatus').innerHTML = 'ğŸ”´ æ¨¡æ‹Ÿæœªå¯åŠ¨';
        }

        function clearAllStudents() {
            simulatedStudents = [];
            updateStudentGrid([]);
            updateMetrics([]);
            updateAnalytics();
            stopAISimulation();
            addNotification('ğŸ—‘ï¸ å·²æ¸…ç©ºæ‰€æœ‰å­¦ç”Ÿæ•°æ®', 'info');
        }

        // æ¨¡æ‹ŸAIè®¡ç®—æœºè§†è§‰æ£€æµ‹
        function simulateAIDetection() {
            if (simulatedStudents.length === 0) return;

            const detectionTypes = [
                { type: 'face_focus', message: 'æ£€æµ‹åˆ°é¢éƒ¨ä¸“æ³¨', metric: 'gaze_focus', change: 5 },
                { type: 'hand_raise', message: 'æ£€æµ‹åˆ°ä¸¾æ‰‹åŠ¨ä½œ', metric: 'interaction_frequency', change: 8 },
                { type: 'posture_good', message: 'æ£€æµ‹åˆ°ç«¯æ­£åå§¿', metric: 'posture_engagement', change: 6 },
                { type: 'distraction', message: 'æ£€æµ‹åˆ°æ³¨æ„åŠ›åˆ†æ•£', metric: 'gaze_focus', change: -10 },
                { type: 'looking_around', message: 'æ£€æµ‹åˆ°ç¯é¡¾å››å‘¨', metric: 'posture_engagement', change: -8 },
                { type: 'active_participation', message: 'æ£€æµ‹åˆ°ç§¯æå‚ä¸', metric: 'interaction_frequency', change: 12 }
            ];

            const randomDetection = detectionTypes[Math.floor(Math.random() * detectionTypes.length)];
            const randomStudent = simulatedStudents[Math.floor(Math.random() * simulatedStudents.length)];

            // æ›´æ–°å­¦ç”ŸæŒ‡æ ‡
            updateStudentWithAIDetection(randomStudent, randomDetection);
            
            // å‘é€é€šçŸ¥
            addNotification(`ğŸ¤– ${randomStudent.name} ${randomDetection.message}`, 'action');
            
            // æ›´æ–°ç•Œé¢
            updateStudentGrid(simulatedStudents);
            updateMetrics(simulatedStudents);
            updateAnalytics();
            updateAdvancedAnalytics();
        }

        function updateStudentWithAIDetection(student, detection) {
            // æ›´æ–°è¯¦ç»†æŒ‡æ ‡
            if (student.detailed_metrics) {
                const currentValue = student.detailed_metrics[detection.metric] || 50;
                const newValue = Math.max(0, Math.min(100, currentValue + detection.change));
                student.detailed_metrics[detection.metric] = newValue;
            }

            // æ ¹æ®è¯¦ç»†æŒ‡æ ‡æ›´æ–°ä¸»è¦æŒ‡æ ‡
            updateMainMetricsFromAI(student);
            
            student.last_updated = new Date().toISOString();
        }

        function updateMainMetricsFromAI(student) {
            if (!student.detailed_metrics) return;

            // åŸºäºè®¡ç®—æœºè§†è§‰æ•°æ®è®¡ç®—ä¸»è¦æŒ‡æ ‡
            const gazeWeight = 0.4;
            const postureWeight = 0.3;
            const interactionWeight = 0.3;

            const newAttention = Math.round(
                (student.detailed_metrics.gaze_focus * gazeWeight) +
                (student.detailed_metrics.posture_engagement * postureWeight) +
                (student.detailed_metrics.interaction_frequency * interactionWeight)
            );

            const newEngagement = Math.round(
                (student.detailed_metrics.gaze_focus * 0.3) +
                (student.detailed_metrics.posture_engagement * 0.4) +
                (student.detailed_metrics.interaction_frequency * 0.3)
            );

            student.attention_level = Math.max(0, Math.min(100, newAttention));
            student.engagement_level = Math.max(0, Math.min(100, newEngagement));

            // æ ¹æ®æŒ‡æ ‡æ›´æ–°æƒ…æ„ŸçŠ¶æ€
            updateEmotionFromMetrics(student);
        }

        function updateEmotionFromMetrics(student) {
            const attention = student.attention_level;
            const engagement = student.engagement_level;

            if (attention >= 80 && engagement >= 80) {
                student.emotion = 'focused';
            } else if (attention >= 70 && engagement >= 70) {
                student.emotion = 'engaged';
            } else if (attention >= 60) {
                student.emotion = 'neutral';
            } else if (attention >= 40) {
                student.emotion = 'confused';
            } else {
                student.emotion = 'bored';
            }
        }

        // æ‰‹åŠ¨è§¦å‘AIæ£€æµ‹
        function triggerAIDetection(detectionType) {
            if (simulatedStudents.length === 0) {
                addNotification('âŒ æ²¡æœ‰å­¦ç”Ÿå¯ä»¥æ£€æµ‹', 'error');
                return;
            }

            const detectionMap = {
                'face_focus': { message: 'é¢éƒ¨ä¸“æ³¨æ£€æµ‹', metric: 'gaze_focus', change: 15 },
                'hand_raise': { message: 'ä¸¾æ‰‹åŠ¨ä½œæ£€æµ‹', metric: 'interaction_frequency', change: 20 },
                'posture_good': { message: 'ç«¯æ­£åå§¿æ£€æµ‹', metric: 'posture_engagement', change: 18 },
                'distraction': { message: 'æ³¨æ„åŠ›åˆ†æ•£æ£€æµ‹', metric: 'gaze_focus', change: -25 }
            };

            const detection = detectionMap[detectionType];
            if (!detection) return;

            const randomStudent = simulatedStudents[Math.floor(Math.random() * simulatedStudents.length)];
            updateStudentWithAIDetection(randomStudent, detection);
            
            addNotification(`ğŸ–¥ï¸ è®¡ç®—æœºè§†è§‰: ${randomStudent.name} ${detection.message}`, 'action');
            
            updateStudentGrid(simulatedStudents);
            updateMetrics(simulatedStudents);
            updateAnalytics();
            updateAdvancedAnalytics();
        }

        // æ›´æ–°å­¦ç”Ÿç½‘æ ¼
        function updateStudentGrid(students) {
            const grid = document.getElementById('studentsGrid');
            
            if (students.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ“</div>
                        <h4>æš‚æ— å­¦ç”Ÿæ•°æ®</h4>
                        <p>ç‚¹å‡»"ç”Ÿæˆæ¨¡æ‹Ÿå­¦ç”Ÿ"å¼€å§‹è¯¾å ‚ç›‘æ§</p>
                    </div>
                `;
                return;
            }

            grid.innerHTML = '';
            students.forEach(student => {
                const studentCard = document.createElement('div');
                studentCard.className = 'student-card';
                
                const learningState = getLearningState(student);
                const emotionCategory = getEmotionCategory(student.emotion);
                
                studentCard.innerHTML = `
                    <div class="student-name">${student.name}</div>
                    <div class="student-metrics">
                        <div class="metric">
                            <span>æ³¨æ„åŠ›: </span>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${student.attention_level}%"></div>
                            </div>
                            <span>${student.attention_level}%</span>
                        </div>
                        <div class="metric">
                            <span>å‚ä¸åº¦: </span>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${student.engagement_level}%"></div>
                            </div>
                            <span>${student.engagement_level}%</span>
                        </div>
                    </div>
                    <div class="student-footer">
                        <div class="student-emotion ${student.emotion}">
                            <span class="emotion-indicator emotion-${emotionCategory}"></span>
                            ${student.emotion}
                        </div>
                        <div class="learning-state state-${learningState}">
                            ${getStateText(learningState)}
                        </div>
                    </div>
                    ${student.detailed_metrics ? `
                    <div class="detailed-metrics">
                        <div class="detail-item">ğŸ‘€ ${student.detailed_metrics.gaze_focus}%</div>
                        <div class="detail-item">ğŸ’º ${student.detailed_metrics.posture_engagement}%</div>
                        <div class="detail-item">ğŸ™‹ ${student.detailed_metrics.interaction_frequency}%</div>
                    </div>
                    ` : ''}
                `;
                grid.appendChild(studentCard);
            });

            document.getElementById('studentCount').textContent = `å­¦ç”Ÿæ•°: ${students.length}`;
        }

        function updateMetrics(students) {
            if (students.length === 0) {
                document.getElementById('avgAttention').textContent = 'å¹³å‡æ³¨æ„åŠ›: --%';
                document.getElementById('avgAttentionMetric').textContent = '0%';
                document.getElementById('avgEngagement').textContent = '0%';
                document.getElementById('activeStudents').textContent = '0';
                return;
            }

            const avgAttention = students.reduce((sum, s) => sum + s.attention_level, 0) / students.length;
            const avgEngagement = students.reduce((sum, s) => sum + s.engagement_level, 0) / students.length;

            document.getElementById('avgAttention').textContent = `å¹³å‡æ³¨æ„åŠ›: ${avgAttention.toFixed(1)}%`;
            document.getElementById('avgAttentionMetric').textContent = `${avgAttention.toFixed(1)}%`;
            document.getElementById('avgEngagement').textContent = `${avgEngagement.toFixed(1)}%`;
            document.getElementById('activeStudents').textContent = students.length;

            // æ›´æ–°è®¡ç®—æœºè§†è§‰æŒ‡æ ‡
            updateVisionMetrics(students);
        }

        function updateVisionMetrics(students) {
            if (students.length === 0) return;

            const avgGaze = students.reduce((sum, s) => sum + (s.detailed_metrics?.gaze_focus || 0), 0) / students.length;
            const avgPosture = students.reduce((sum, s) => sum + (s.detailed_metrics?.posture_engagement || 0), 0) / students.length;
            const avgInteraction = students.reduce((sum, s) => sum + (s.detailed_metrics?.interaction_frequency || 0), 0) / students.length;

            document.getElementById('gazeFocusValue').textContent = `${Math.round(avgGaze)}%`;
            document.getElementById('gazeFocusBar').style.width = `${Math.round(avgGaze)}%`;
            document.getElementById('postureValue').textContent = `${Math.round(avgPosture)}%`;
            document.getElementById('postureBar').style.width = `${Math.round(avgPosture)}%`;
            document.getElementById('interactionValue').textContent = `${Math.round(avgInteraction)}%`;
            document.getElementById('interactionBar').style.width = `${Math.round(avgInteraction)}%`;
        }

        function getEmotionCategory(emotion) {
            if (['focused', 'happy', 'engaged', 'excited'].includes(emotion)) return 'positive';
            if (['confused', 'bored', 'frustrated', 'distracted'].includes(emotion)) return 'negative';
            return 'neutral';
        }

        function getLearningState(student) {
            const attention = student.attention_level;
            const engagement = student.engagement_level;
            
            if (attention >= 80 && engagement >= 80) return 'excellent';
            if (attention >= 60 && engagement >= 60) return 'moderate';
            return 'needs_help';
        }

        function getStateText(state) {
            const texts = {
                'excellent': 'ä¼˜ç§€',
                'moderate': 'è‰¯å¥½', 
                'needs_help': 'éœ€å…³æ³¨'
            };
            return texts[state] || state;
        }

        function updateAnalytics() {
            if (simulatedStudents.length === 0) return;

            const emotionDistribution = {
                positive: simulatedStudents.filter(s => getEmotionCategory(s.emotion) === 'positive').length,
                neutral: simulatedStudents.filter(s => getEmotionCategory(s.emotion) === 'neutral').length,
                negative: simulatedStudents.filter(s => getEmotionCategory(s.emotion) === 'negative').length
            };

            const attentionLevels = simulatedStudents.map(s => s.attention_level);
            const engagementLevels = simulatedStudents.map(s => s.engagement_level);

            const avgAttention = attentionLevels.reduce((a, b) => a + b, 0) / attentionLevels.length;
            const attentionVariance = attentionLevels.reduce((sum, val) => sum + Math.pow(val - avgAttention, 2), 0) / attentionLevels.length;

            updateEmotionChart(emotionDistribution);
            updateAttentionMetrics({
                high_attention_count: attentionLevels.filter(a => a > 80).length,
                low_attention_count: attentionLevels.filter(a => a < 50).length,
                attention_variance: attentionVariance
            });
        }

        function updateEmotionChart(emotionDistribution) {
            const chart = document.getElementById('emotionChart');
            chart.innerHTML = '';
            
            const total = emotionDistribution.positive + emotionDistribution.neutral + emotionDistribution.negative;
            const maxHeight = 100;
            
            ['positive', 'neutral', 'negative'].forEach(category => {
                const count = emotionDistribution[category];
                const percentage = total > 0 ? (count / total) * 100 : 0;
                const height = (percentage / 100) * maxHeight;
                
                const bar = document.createElement('div');
                bar.className = `emotion-bar ${category}`;
                bar.style.height = `${height}px`;
                bar.innerHTML = `<div class="emotion-label">${getEmotionLabel(category)}<br>${Math.round(percentage)}%</div>`;
                chart.appendChild(bar);
            });
        }

        function getEmotionLabel(category) {
            const labels = {
                'positive': 'ç§¯æ',
                'neutral': 'ä¸­æ€§', 
                'negative': 'æ¶ˆæ'
            };
            return labels[category] || category;
        }

        function updateAttentionMetrics(metrics) {
            document.getElementById('highAttentionCount').textContent = metrics.high_attention_count;
            document.getElementById('lowAttentionCount').textContent = metrics.low_attention_count;
            document.getElementById('attentionStability').textContent = `${Math.max(0, 100 - metrics.attention_variance).toFixed(1)}%`;
        }

        // é€šçŸ¥ç³»ç»Ÿ
        function addNotification(message, type = 'info') {
            notificationCount++;
            const notificationList = document.getElementById('notificationList');
            const notification = document.createElement('div');
            notification.className = `notification-item ${type}`;
            notification.innerHTML = `
                <span class="notification-time">${new Date().toLocaleTimeString('zh-CN')}</span>
                <span class="notification-message">${message}</span>
            `;
            
            notificationList.insertBefore(notification, notificationList.firstChild);
            
            // é™åˆ¶é€šçŸ¥æ•°é‡
            if (notificationList.children.length > 10) {
                notificationList.removeChild(notificationList.lastChild);
            }
            
            // æ˜¾ç¤ºé€šçŸ¥é¢æ¿
            document.getElementById('notificationPanel').style.display = 'block';
        }

        function clearNotifications() {
            document.getElementById('notificationList').innerHTML = `
                <div class="notification-item info">
                    <span class="notification-time" id="currentTime"></span>
                    <span class="notification-message">é€šçŸ¥å·²æ¸…ç©º</span>
                </div>
            `;
            notificationCount = 0;
        }

        function startQuickQuestion() {
            const question = document.getElementById('questionInput').value;
            if (question) {
                // æ¨¡æ‹Ÿå­¦ç”Ÿå›ç­”é—®é¢˜
                if (simulatedStudents.length > 0) {
                    const randomStudent = simulatedStudents[Math.floor(Math.random() * simulatedStudents.length)];
                    setTimeout(() => {
                        addNotification(`ğŸ’¬ ${randomStudent.name} å›ç­”äº†é—®é¢˜: ${getRandomAnswer()}`, 'response');
                    }, 1000);
                }
                
                addNotification(`ğŸ“ å‘å¸ƒäº†æ–°é—®é¢˜: ${question}`, 'question');
                document.getElementById('questionInput').value = '';
            }
        }

        function getRandomAnswer() {
            const answers = ['A', 'B', 'C', 'D', 'æ­£ç¡®', 'é”™è¯¯', 'æ˜ç™½äº†', 'è¿˜éœ€è¦è®²è§£'];
            return answers[Math.floor(Math.random() * answers.length)];
        }

        // åˆå§‹åŒ–å›¾è¡¨
        function initCharts() {
            const ctx = document.getElementById('engagementChart').getContext('2d');
            engagementChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'å¹³å‡æ³¨æ„åŠ›',
                        data: [],
                        borderColor: '#667eea',
                        tension: 0.4,
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });
        }

        // æ–°å¢JavaScriptåŠŸèƒ½

        // åˆå§‹åŒ–å­¦ç”Ÿé€‰æ‹©å™¨
        function initStudentSelector() {
            const selector = document.getElementById('studentSelector');
            selector.innerHTML = '<option value="">é€‰æ‹©å­¦ç”Ÿ...</option>';
            
            if (simulatedStudents.length > 0) {
                simulatedStudents.forEach(student => {
                    const option = document.createElement('option');
                    option.value = student.id;
                    option.textContent = student.name;
                    selector.appendChild(option);
                });
            }
        }

        // åŠ è½½å­¦ç”Ÿåˆ†æ
        function loadStudentAnalysis() {
            const studentId = document.getElementById('studentSelector').value;
            if (!studentId) return;
            
            try {
                // æ¨¡æ‹ŸAPIè°ƒç”¨ - åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œåº”è¯¥ä»æœåŠ¡å™¨è·å–æ•°æ®
                const student = simulatedStudents.find(s => s.id === studentId);
                if (student) {
                    const data = generateStudentAnalysisData(student);
                    displayStudentAnalysis(data);
                }
            } catch (error) {
                console.error('åŠ è½½å­¦ç”Ÿåˆ†æå¤±è´¥:', error);
                document.getElementById('studentAnalysisResult').innerHTML = 
                    '<p style="color: #f56565;">åˆ†æåŠ è½½å¤±è´¥</p>';
            }
        }

        // ç”Ÿæˆæ¨¡æ‹Ÿå­¦ç”Ÿåˆ†ææ•°æ®
        function generateStudentAnalysisData(student) {
            return {
                student_info: {
                    name: student.name,
                    id: student.id
                },
                advanced_analysis: {
                    attention_patterns: {
                        average_attention: student.attention_level,
                        attention_stability: Math.round(80 + Math.random() * 15),
                        high_attention_percentage: Math.round(student.attention_level * 0.8 + Math.random() * 20)
                    },
                    anomalies: student.attention_level < 50 ? [
                        {
                            message: 'æ³¨æ„åŠ›æŒç»­åä½',
                            severity: 'high',
                            suggestion: 'å»ºè®®ç«‹å³å…³æ³¨å¹¶æä¾›å¸®åŠ©'
                        }
                    ] : [],
                    recommendations: [
                        {
                            action: 'æä¾›ä¸ªæ€§åŒ–å­¦ä¹ ææ–™',
                            reason: 'æ ¹æ®å­¦ä¹ æ¨¡å¼åˆ†æï¼Œè¯¥å­¦ç”Ÿæ›´é€‚åˆè§†è§‰å­¦ä¹ '
                        },
                        {
                            action: 'å¢åŠ äº’åŠ¨ç¯èŠ‚',
                            reason: 'äº’åŠ¨å‚ä¸åº¦è¾ƒä½ï¼Œéœ€è¦æ›´å¤šå‚ä¸æœºä¼š'
                        }
                    ]
                }
            };
        }

        // æ˜¾ç¤ºå­¦ç”Ÿåˆ†æç»“æœ
        function displayStudentAnalysis(data) {
            const container = document.getElementById('studentAnalysisResult');
            const analysis = data.advanced_analysis;
            
            let html = `
                <div class="student-analysis">
                    <h4>${data.student_info.name} çš„å­¦ä¹ åˆ†æ</h4>
                    <div class="analysis-section">
                        <h5>æ³¨æ„åŠ›æ¨¡å¼</h5>
                        <div class="metric-grid">
                            <div class="metric">
                                <span>å¹³å‡æ³¨æ„åŠ›:</span>
                                <span>${analysis.attention_patterns.average_attention}%</span>
                            </div>
                            <div class="metric">
                                <span>ç¨³å®šæ€§:</span>
                                <span>${analysis.attention_patterns.attention_stability}%</span>
                            </div>
                            <div class="metric">
                                <span>é«˜æ³¨æ„åŠ›æ—¶æ®µ:</span>
                                <span>${analysis.attention_patterns.high_attention_percentage}%</span>
                            </div>
                        </div>
                    </div>
            `;
            
            // æ·»åŠ å¼‚å¸¸æ£€æµ‹
            if (analysis.anomalies && analysis.anomalies.length > 0) {
                html += `
                    <div class="analysis-section">
                        <h5>æ£€æµ‹åˆ°å¼‚å¸¸</h5>
                        ${analysis.anomalies.map(anomaly => `
                            <div class="anomaly-item ${anomaly.severity}">
                                <strong>${anomaly.message}</strong>
                                <p>${anomaly.suggestion}</p>
                            </div>
                        `).join('')}
                    </div>
                `;
            }
            
            // æ·»åŠ å»ºè®®
            if (analysis.recommendations && analysis.recommendations.length > 0) {
                html += `
                    <div class="analysis-section">
                        <h5>ä¸ªæ€§åŒ–å»ºè®®</h5>
                        ${analysis.recommendations.map(rec => `
                            <div class="recommendation-item">
                                <div class="rec-icon">ğŸ’¡</div>
                                <div class="rec-content">
                                    <div class="rec-title">${rec.action}</div>
                                    <div class="rec-description">${rec.reason}</div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }
            
            html += '</div>';
            container.innerHTML = html;
        }

        // æ›´æ”¹æ—¶é—´èŒƒå›´
        function changeTimeRange(hours) {
            currentTimeRange = hours;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.time-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // é‡æ–°åŠ è½½å†å²æ•°æ®
            loadHistoricalData();
        }

        // åŠ è½½å†å²æ•°æ®
        function loadHistoricalData() {
            if (simulatedStudents.length === 0) return;
            
            try {
                // è¿™é‡Œç®€åŒ–å®ç°ï¼Œå®é™…åº”è¯¥ä»æœåŠ¡å™¨è·å–æ•°æ®
                updateHistoricalChart(generateHistoricalData());
            } catch (error) {
                console.error('åŠ è½½å†å²æ•°æ®å¤±è´¥:', error);
            }
        }

        // ç”Ÿæˆæ¨¡æ‹Ÿå†å²æ•°æ®
        function generateHistoricalData() {
            const labels = [];
            const attentionData = [];
            const engagementData = [];
            
            const now = new Date();
            for (let i = currentTimeRange; i >= 0; i--) {
                const time = new Date(now.getTime() - i * 60 * 60 * 1000);
                labels.push(time.getHours() + ':00');
                
                // æ¨¡æ‹Ÿæ•°æ®æ³¢åŠ¨
                const baseAttention = 60 + Math.random() * 30;
                const baseEngagement = 65 + Math.random() * 25;
                
                attentionData.push(Math.round(baseAttention));
                engagementData.push(Math.round(baseEngagement));
            }
            
            return { labels, attentionData, engagementData };
        }

        // æ›´æ–°å†å²å›¾è¡¨
        function updateHistoricalChart(data) {
            const ctx = document.getElementById('historicalTrendChart').getContext('2d');
            
            if (historicalTrendChart) {
                historicalTrendChart.destroy();
            }
            
            historicalTrendChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.labels,
                    datasets: [
                        {
                            label: 'å¹³å‡æ³¨æ„åŠ›',
                            data: data.attentionData,
                            borderColor: '#667eea',
                            backgroundColor: 'rgba(102, 126, 234, 0.1)',
                            tension: 0.4,
                            fill: true
                        },
                        {
                            label: 'å¹³å‡å‚ä¸åº¦',
                            data: data.engagementData,
                            borderColor: '#48bb78',
                            backgroundColor: 'rgba(72, 187, 120, 0.1)',
                            tension: 0.4,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });
        }

        // æ›´æ–°å­¦ä¹ æ¨¡å¼è¯†åˆ«
        function updateLearningPatterns() {
            if (simulatedStudents.length === 0) return;
            
            let efficientCount = 0;
            let needsAttentionCount = 0;
            let volatileCount = 0;
            
            simulatedStudents.forEach(student => {
                const attention = student.attention_level;
                const engagement = student.engagement_level;
                
                if (attention >= 80 && engagement >= 80) {
                    efficientCount++;
                } else if (attention < 60 || engagement < 60) {
                    needsAttentionCount++;
                } else {
                    volatileCount++;
                }
            });
            
            document.getElementById('efficientLearners').textContent = efficientCount;
            document.getElementById('needsAttention').textContent = needsAttentionCount;
            document.getElementById('volatileLearners').textContent = volatileCount;
        }

        // æ›´æ–°å¼‚å¸¸æ£€æµ‹
        function updateAnomalyDetection() {
            const anomalyList = document.getElementById('anomalyList');
            
            // æ¨¡æ‹Ÿå¼‚å¸¸æ£€æµ‹
            const anomalies = [];
            
            simulatedStudents.forEach(student => {
                if (student.attention_level < 40) {
                    anomalies.push({
                        student: student.name,
                        type: 'ä½æ³¨æ„åŠ›',
                        severity: 'high',
                        message: `${student.name} æ³¨æ„åŠ›æ°´å¹³è¿‡ä½ (${student.attention_level}%)`,
                        suggestion: 'å»ºè®®ç«‹å³å…³æ³¨å¹¶æä¾›å¸®åŠ©'
                    });
                } else if (student.engagement_level < 40) {
                    anomalies.push({
                        student: student.name,
                        type: 'ä½å‚ä¸åº¦',
                        severity: 'medium',
                        message: `${student.name} å‚ä¸åº¦è¾ƒä½ (${student.engagement_level}%)`,
                        suggestion: 'å»ºè®®å¢åŠ äº’åŠ¨æé«˜å‚ä¸æ„Ÿ'
                    });
                }
            });
            
            if (anomalies.length === 0) {
                anomalyList.innerHTML = '<div class="anomaly-item none"><span>æš‚æ— å¼‚å¸¸æ£€æµ‹</span></div>';
            } else {
                anomalyList.innerHTML = anomalies.map(anomaly => `
                    <div class="anomaly-item ${anomaly.severity}">
                        <strong>${anomaly.message}</strong>
                        <p>${anomaly.suggestion}</p>
                    </div>
                `).join('');
            }
        }

        // æ›´æ–°æ•™å­¦å»ºè®®
        function updateTeachingRecommendations() {
            const recommendationsContainer = document.getElementById('teachingRecommendations');
            
            const recommendations = [
                {
                    icon: 'ğŸ¯',
                    title: 'åˆ†ç»„äº’åŠ¨æ•™å­¦',
                    description: 'æ ¹æ®å­¦ä¹ æ¨¡å¼å°†å­¦ç”Ÿåˆ†ç»„ï¼Œè¿›è¡Œå·®å¼‚åŒ–æ•™å­¦'
                },
                {
                    icon: 'â±ï¸',
                    title: 'è°ƒæ•´æ•™å­¦èŠ‚å¥',
                    description: 'åœ¨æ³¨æ„åŠ›æ™®éä¸‹é™æ—¶æ®µå®‰æ’ä¼‘æ¯æˆ–äº’åŠ¨æ´»åŠ¨'
                },
                {
                    icon: 'ğŸ“Š',
                    title: 'é‡ç‚¹å…³æ³¨éœ€è¦å¸®åŠ©çš„å­¦ç”Ÿ',
                    description: 'ä¸ºæ³¨æ„åŠ›æŒç»­åä½çš„å­¦ç”Ÿæä¾›é¢å¤–æ”¯æŒ'
                }
            ];
            
            recommendationsContainer.innerHTML = recommendations.map(rec => `
                <div class="recommendation-item">
                    <div class="rec-icon">${rec.icon}</div>
                    <div class="rec-content">
                        <div class="rec-title">${rec.title}</div>
                        <div class="rec-description">${rec.description}</div>
                    </div>
                </div>
            `).join('');
        }

        // åœ¨ç°æœ‰çš„æ¨¡æ‹Ÿæ›´æ–°å‡½æ•°ä¸­è°ƒç”¨æ–°åŠŸèƒ½
        function updateAdvancedAnalytics() {
            updateLearningPatterns();
            updateAnomalyDetection();
            updateTeachingRecommendations();
            loadHistoricalData();
        }
    </script>
</body>
</html>